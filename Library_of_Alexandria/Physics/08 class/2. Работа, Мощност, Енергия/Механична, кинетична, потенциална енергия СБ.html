<!-- Created by Silvy Evtimov Banzhov, 12.2025 -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Енергия и работа / Energy and Work</title>
<style>
html, body { margin:0; padding:0; height:100%; font-family:sans-serif; }
body { display:flex; height:100vh; }

#controls {
  width:40%; padding:30px; background:#f2f2f2; box-sizing:border-box; display:flex; flex-direction:column; justify-content:space-between;
}
#controls h2 { font-size:32px; margin-bottom:20px; }
label { font-size:26px; margin-top:20px; }
input, button { font-size:26px; padding:8px; width:100%; margin-top:8px; }
button { cursor:pointer; }
#info { font-size:22px; margin-top:20px; min-height:80px; }

#visual { width:60%; display:flex; align-items:center; justify-content:center; background:#e8eef5; border-left:3px solid #bbb; position:relative; }

#canvas { background:#eef; border:2px solid #333; height:80%; aspect-ratio:1/2; }

#speedBox { position:absolute; top:10px; right:10px; font-size:22px; background:#fff; padding:6px 12px; border:1px solid #aaa; border-radius:6px; }

#barsContainer {
  position:absolute;
  bottom:10px;
  right:10px;
  display:flex;
  flex-direction:row;
  align-items:flex-end;
  gap:12px;
  height:60%;
}

.barWrap {
  display:flex;
  flex-direction:column;
  align-items:center;
}

.bar {
  width:35px;
  transition: height 0.05s;
}

.barLabel {
  font-size:24px;
  margin-top:6px;
  text-align:center;
}

#langBtn { margin-top:20px; font-size:22px; }
</style>
</head>
<body>

<div id="controls">
  <div>
    <h2 id="title">Енергия и работа</h2>

    <label id="mLabel">Маса (kg)</label>
    <input type="number" id="mass" value="2">

    <label id="hLabel">Височина (m)</label>
    <input type="number" id="height" value="5">

    <label id="sLabel">Положение (slider)</label>
    <input type="range" id="slider" min="0" max="1" step="0.001" value="0">

    <button onclick="start()">Пусни</button>
    <button onclick="pause()">Пауза</button>

    <div id="info"></div>
  </div>

  <button id="langBtn" onclick="toggleLang()">BG / EN</button>
</div>

<div id="visual">
  <canvas id="canvas"></canvas>
  <div id="speedBox">v: 0.00 m/s</div>

  <div id="barsContainer">
    <div class="barWrap">
      <div id="ke" class="bar" style="background:#2e86de;"></div>
      <div class="barLabel">Ek</div>
    </div>
    <div class="barWrap">
      <div id="pe" class="bar" style="background:#c0392b;"></div>
      <div class="barLabel">Ep</div>
    </div>
    <div class="barWrap">
      <div id="te" class="bar" style="background:#27ae60;"></div>
      <div class="barLabel">E</div>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const slider = document.getElementById("slider");
const info = document.getElementById("info");
const ke = document.getElementById("ke");
const pe = document.getElementById("pe");
const te = document.getElementById("te");
const speedBox = document.getElementById("speedBox");
let m,h,g=9.81,y=0,v=0,running=false,dt=0.02,anim;
const R=16;
let lang="BG";
let impactFrames=0;

function resizeCanvas(){
  canvas.height = document.getElementById("visual").clientHeight*0.8;
  canvas.width = canvas.height*0.5;
}
resizeCanvas();
window.onresize = resizeCanvas;

function start(){
  cancelAnimationFrame(anim);
  m=+mass.value; h=+height.value;
  y=0; v=0; running=true;
  animate();
}

function pause(){ running=false; }

function animate(){
  if(running){
    v += g*dt;
    y += v*dt;
    if(y>=h){ y=h; v=0; running=false; impactFrames=5; } // trigger impact animation
  }
  slider.value = y/h;
  draw();
  updateEnergy();
  anim = requestAnimationFrame(animate);
}

slider.oninput = () => {
  y = slider.value * h;

  if(y >= h){  // impact condition
    y = h;
    v = 0;
  } else {
    v = Math.sqrt(2 * g * y);
  }

  draw();
  updateEnergy();
};

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const ground = canvas.height-R;
  const py = (y/h)*(ground-R);

  ctx.fillStyle="orange";
  ctx.beginPath();
  ctx.arc(canvas.width/2, py, R,0,Math.PI*2);
  ctx.fill();

  // impact animation
  if(impactFrames>0){
    ctx.strokeStyle="#555";
    ctx.lineWidth=3;
    for(let i=0;i<5;i++){
      ctx.beginPath();
      ctx.moveTo(canvas.width/2-20, ground - i*2);
      ctx.lineTo(canvas.width/2+20, ground - i*2);
      ctx.stroke();
    }
    impactFrames--;
  }
}

function updateEnergy(){
  const Ep = m*g*(h-y);
  const Ek = 0.5*m*v*v;
  const EtTotal = m*g*h; // constant total energy before impact
  let displayedTotal = EtTotal;

  if(y >= h){ // impact
    ke.style.height = "0px";
    pe.style.height = "0px";
    te.style.height = "0px";
    displayedTotal = 0; // total energy also visually 0
  } else {
    ke.style.height = (Ek/EtTotal*canvas.height) + "px";
    pe.style.height = (Ep/EtTotal*canvas.height) + "px";
    te.style.height = canvas.height + "px"; // total energy full
  }

  speedBox.innerHTML = `v: ${v.toFixed(2)} m/s`;

  info.innerHTML = lang==="BG" ?
    `Ek = ${Ek.toFixed(1)} J<br>Ep = ${Ep.toFixed(1)} J<br>E = ${displayedTotal.toFixed(1)} J`
    :
    `KE = ${Ek.toFixed(1)} J<br>PE = ${Ep.toFixed(1)} J<br>E = ${displayedTotal.toFixed(1)} J`;
}

function toggleLang(){
  lang = lang==="BG"?"EN":"BG";
  title.textContent = lang==="BG"?"Енергия и работа":"Energy and Work";
  mLabel.textContent = lang==="BG"?"Маса (kg)":"Mass (kg)";
  hLabel.textContent = lang==="BG"?"Височина (m)":"Height (m)";
  sLabel.textContent = lang==="BG"?"Положение (slider)":"Position (slider)";
}
</script>
</body>
</html>
