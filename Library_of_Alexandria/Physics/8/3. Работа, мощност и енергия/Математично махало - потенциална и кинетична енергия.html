<!-- Created by Silvy Evtimov Banzhov, 12.2025 -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Просто махало / Simple Pendulum</title>
<style>
html, body { margin:0; padding:0; font-family:sans-serif; height:100%; }
body { display:flex; height:100vh; }

#controls {
    width:40%; padding:30px; background:#f2f2f2; box-sizing:border-box; display:flex; flex-direction:column; justify-content:flex-start;
}
#controls h2 { font-size:32px; margin-bottom:20px; }
label { font-size:24px; margin-top:15px; display:block; }
input, button { font-size:22px; padding:6px; margin-top:6px; width:100%; }
button { cursor:pointer; }

#visual { width:60%; background:#e8eef5; display:flex; align-items:center; justify-content:center; border-left:3px solid #bbb; position:relative; }

#canvas { background:#eef; border:2px solid #333; height:90%; }

#speedBox { position:absolute; bottom:20px; left:20px; font-size:20px; background:#fff; padding:6px 12px; border:1px solid #aaa; border-radius:6px; }

#barsContainer {
    position:absolute; bottom:10px; right:10px;
    display:flex; flex-direction:row; align-items:flex-end; gap:8px; height:60%;
}

.barWrap { display:flex; flex-direction:column; align-items:center; }
.bar { width:30px; transition: height 0.05s; }
.barLabel { font-size:18px; margin-top:4px; text-align:center; }

#slider { margin-top:20px; width:100%; }
</style>
</head>
<body>

<div id="controls">
    <h2 id="title">Просто махало / Simple Pendulum</h2>
    <label>Начален ъгъл (°) / Starting Angle (deg): <input type="number" id="angle" value="30" step="1"></label>

    <button onclick="startPendulum()">Старт / Start</button>
    <button onclick="pausePendulum()">Пауза / Pause</button>
    <button id="langBtn" onclick="toggleLang()">BG / EN</button>

    <p id="info"></p>
    <input type="range" id="slider" min="-1" max="1" step="0.001" value="0">
</div>

<div id="visual">
    <canvas id="canvas"></canvas>

    <div id="barsContainer">
        <div class="barWrap">
            <div id="ke" class="bar" style="background:#2e86de;"></div>
            <div class="barLabel">E<sub>k</sub></div>
        </div>
        <div class="barWrap">
            <div id="pe" class="bar" style="background:#c0392b;"></div>
            <div class="barLabel">E<sub>p</sub></div>
        </div>
    </div>

    <div id="speedBox">v: 0.00 m/s</div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const slider = document.getElementById('slider');
const info = document.getElementById('info');
const ke = document.getElementById('ke');
const pe = document.getElementById('pe');
const speedBox = document.getElementById('speedBox');

let theta = 0, omega = 0, L = 2, alpha = 0, animation;
let g = 9.81, running = false;
let maxTheta = 0, dt = 0.02;
let lang = "BG";

function resizeCanvas(){
    const visual = document.getElementById("visual");
    canvas.height = visual.clientHeight * 0.9;
    canvas.width = canvas.height; // square for no stretching
}
resizeCanvas();
window.onresize = resizeCanvas;

function startPendulum(){
    cancelAnimationFrame(animation);
    L = 2;
    maxTheta = parseFloat(document.getElementById('angle').value) * Math.PI / 180;
    theta = maxTheta;
    omega = 0;
    running = true;
    animate();
}

function pausePendulum(){ running = false; }

slider.oninput = () => {
    theta = slider.value * maxTheta;
    omega = 0; // pendulum paused
    drawPendulum();
    updateEnergy();
};

function animate(){
    if(running){
        alpha = -g/L * Math.sin(theta);
        omega += alpha * dt;
        theta += omega * dt;

        // update slider
        slider.value = theta / maxTheta;

        drawPendulum();
        updateEnergy();
    }
    animation = requestAnimationFrame(animate);
}

function drawPendulum(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const originX = canvas.width / 2;
    const originY = 50;
    const scale = canvas.height / (L*2); 
    const x = originX + L * scale * Math.sin(theta);
    const y = originY + L * scale * Math.cos(theta);

    // rod
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(originX, originY);
    ctx.lineTo(x, y);
    ctx.stroke();

    // bob
    ctx.fillStyle = 'purple';
    ctx.beginPath();
    ctx.arc(x, y, 15, 0, Math.PI*2);
    ctx.fill();
}

function updateEnergy(){
    const m = 1;
    const Et = m * g * L * (1 - Math.cos(maxTheta));
    const Ep = m * g * L * (1 - Math.cos(theta));
    const Ek = Et - Ep;

    const EpPercent = (Ep/Et*100).toFixed(1);
    const EkPercent = (Ek/Et*100).toFixed(1);

    pe.style.height = (EpPercent/100 * canvas.height) + "px";
    ke.style.height = (EkPercent/100 * canvas.height) + "px";

    speedBox.innerHTML = `v: ${(L*omega).toFixed(2)} m/s`;

    info.innerHTML = lang==="BG" ?
        `E<sub>p</sub>: ${EpPercent}%<br>E<sub>k</sub>: ${EkPercent}%<br>E: 100%`
        : `E<sub>p</sub>: ${EpPercent}%<br>E<sub>k</sub>: ${EkPercent}%<br>Total E: 100%`;
}

function toggleLang(){
    if(lang==="BG"){
        lang="EN";
        document.getElementById('title').innerText = "Simple Pendulum";
        document.getElementById('langBtn').innerText = "BG";
    } else {
        lang="BG";
        document.getElementById('title').innerText = "Просто махало";
        document.getElementById('langBtn').innerText = "EN";
    }
}
</script>
</body>
</html>
