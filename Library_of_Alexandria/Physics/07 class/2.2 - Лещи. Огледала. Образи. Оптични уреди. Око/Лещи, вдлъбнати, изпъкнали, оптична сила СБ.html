<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Оптична леща / Lens Simulation</title>
<style>
body { margin:0; font-family:sans-serif; display:flex; height:100vh; }
#controls { width:40%; padding:20px; box-sizing:border-box; background:#f0f0f0; }
#visual { width:60%; position:relative; background:#eef; }
#canvas { width:100%; height:100%; display:block; }
label { font-size:20px; display:block; margin:10px 0; }
input { font-size:20px; width:80px; margin-left:10px; }
h2 { font-size:28px; margin-bottom:20px; }
p { font-size:20px; }
</style>
</head>
<body>
<div id="controls">
<h2>Оптична леща</h2>

<label>Оптична сила D (diopters): 
<input type="number" id="D" value="0" step="0.25"></label>

<label>Брой лъчи: 
<input type="number" id="rayCount" value="7"></label>

<p>Формула: 1/f = D</p>
<p id="focalInfo"></p>
</div>

<div id="visual">
<canvas id="canvas"></canvas>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const Dinput = document.getElementById("D");
const rayInput = document.getElementById("rayCount");
const focalInfo = document.getElementById("focalInfo");

function drawLensAndRays(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const D = parseFloat(Dinput.value);
    const rayCount = parseInt(rayInput.value);
    const lensWidth = 100;
    const lensHeight = canvas.height * 0.9;
    const lensX = canvas.width/2 - lensWidth/2;
    const lensY = canvas.height/2 - lensHeight/2;

    const midY = canvas.height/2;
    const spacing = 30;
    const startX = 50;
    const endX = canvas.width - 50;

    // focal length in pixels
    const f = D!==0 ? 300 / Math.abs(D) : 1000; // scaled for display
    focalInfo.innerText = `Фокусно разстояние f ≈ ${f.toFixed(2)} px`;

    // --- Draw lens ---
    const baseCurve = lensWidth/2;
    const curveAmount = baseCurve + Math.min(Math.abs(D)*8, baseCurve);
    ctx.beginPath();
    // left vertical
    ctx.moveTo(lensX, lensY);
    ctx.bezierCurveTo(lensX - curveAmount * Math.sign(D), lensY + lensHeight*0.25,
                      lensX - curveAmount * Math.sign(D), lensY + lensHeight*0.75,
                      lensX, lensY + lensHeight);
    // bottom horizontal
    ctx.lineTo(lensX + lensWidth, lensY + lensHeight);
    // right vertical
    ctx.bezierCurveTo(lensX + lensWidth + curveAmount * Math.sign(D), lensY + lensHeight*0.75,
                      lensX + lensWidth + curveAmount * Math.sign(D), lensY + lensHeight*0.25,
                      lensX + lensWidth, lensY);
    // top horizontal
    ctx.closePath();
    ctx.fillStyle = "rgba(173,216,230,0.2)";
    ctx.fill();
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 2;
    ctx.stroke();

    // --- Draw rays ---
    for(let i=0;i<rayCount;i++){
        const offset = (i-(rayCount-1)/2)*spacing;
        const y0 = midY + offset;
        const lensMidX = canvas.width/2;

        let focalX;
        if(D>0){ // converging
            focalX = lensMidX + f;
        } else if(D<0){ // diverging
            focalX = lensMidX - f; // virtual focal point
        } else {
            focalX = null; // straight
        }

        ctx.beginPath();
        ctx.moveTo(startX, y0);
        ctx.lineTo(lensMidX, y0); // to lens

        if(D!==0){
            // slope from lens to focal
            const slope = (midY - y0) / (focalX - lensMidX);
            const endY = y0 + slope * (endX - lensMidX);
            ctx.lineTo(endX, endY);
        } else {
            ctx.lineTo(endX, y0);
        }

        ctx.strokeStyle = "red";
        ctx.lineWidth = 2;
        ctx.stroke();
    }
}

// auto-refresh on input change
Dinput.addEventListener('input', drawLensAndRays);
rayInput.addEventListener('input', drawLensAndRays);

drawLensAndRays();
</script>
</body>
</html>
