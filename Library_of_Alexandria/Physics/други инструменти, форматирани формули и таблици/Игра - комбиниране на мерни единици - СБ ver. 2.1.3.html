<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<title>Комбинатор на физични мерни единици от Силви Банжов</title>
<style>
body { font-family: sans-serif; max-width: 1000px; margin: 20px; }
h2,h3 { margin-bottom: 8px; }

.panel { border: 2px solid #888; padding: 16px; margin-bottom: 24px; border-radius: 6px; position: relative; }
.pool { display:flex; flex-wrap: wrap; gap:6px; }

.pool button { width:60px;height:60px; cursor:grab; font-size:20px; user-select:none; display:flex; flex-direction:column; align-items:center; justify-content:center; }

.slots-row { display:flex; gap:12px; margin:12px 0; }

.slot { width:140px;height:60px; border:2px dashed #999; border-radius:6px; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:18px; position:relative; }
.slot.filled { border-style:solid; background:#eef; }
.slot.correct { background:#cfc; transition:background 0.5s; }

.result-box { position:absolute; right:-320px; top:50%; transform:translateY(-50%); width:300px; min-height:140px; padding:20px; border:3px solid #444; border-radius:10px; background:#f0f0f0; font-size:44px; font-weight:bold; line-height:1.2; word-wrap:break-word; overflow-wrap:break-word; white-space:pre-line; }

#merna_controls button { margin-right:20px; padding:20px 40px; font-size:28px; border-radius:10px; cursor:pointer; }

.floating { position:absolute; top:0; left:50%; transform:translateX(-50%); background:#fffa; padding:6px 12px; border-radius:4px; font-weight:bold; font-size:16px; transition:all 1s ease; pointer-events:none; }
</style>
</head>
<body>

<h2>Комбинатор на физични мерни единици от Силви Банжов</h2>

<div class="panel" id="merna_panel">
<h3>Мерна единица</h3>
<div class="pool" id="merna_pool"></div>

<p>Горен ред (умножение):</p>
<div class="slots-row" id="merna_top_slots">
  <div class="slot" data-row="top" data-i="0"></div>
  <div class="slot" data-row="top" data-i="1"></div>
  <div class="slot" data-row="top" data-i="2"></div>
  <div class="slot" data-row="top" data-i="3"></div>
  <div class="slot" data-row="top" data-i="4"></div>
</div>

<p>Долен ред (деление):</p>
<div class="slots-row" id="merna_bottom_slots">
  <div class="slot" data-row="bottom" data-i="0"></div>
  <div class="slot" data-row="bottom" data-i="1"></div>
  <div class="slot" data-row="bottom" data-i="2"></div>
  <div class="slot" data-row="bottom" data-i="3"></div>
  <div class="slot" data-row="bottom" data-i="4"></div>
</div>

<div id="merna_controls">
  <button id="merna_eval">= Пресметни</button>
  <button id="merna_clear">Изчисти</button>
</div>
<div class="result-box" id="merna_res">—</div>
</div>

<script>
// ---------------- Buttons ----------------
const merna_elements = [
  {symbol:"1", label:"единица"},
  {symbol:"m", label:"разстояние"},
  {symbol:"kg", label:"маса"},
  {symbol:"s", label:"време"},
  {symbol:"A", label:"ток"},
  {symbol:"N", label:"сила"},
  {symbol:"Pa", label:"налягане"},
  {symbol:"J", label:"енергия"},
  {symbol:"W", label:"мощност"},
  {symbol:"C", label:"заряд"},
  {symbol:"V", label:"напр."},
  {symbol:"Ω", label:"съпр."},
  {symbol:"Hz", label:"честота"},
  {symbol:"Wb", label:"магн. поток"},
  {symbol:"T", label:"магн. индукция"},
  {symbol:"H", label:"индуктивност"}
];

// ---------------- Combos ----------------
const merna_combos = {
  // Mechanical
  "m*s^-1": "Скорост v [m/s]",
  "m*s^-2": "Ускорение a [m/s²]",
  "kg*m*s^-2": "Сила F [N]",
  "kg*m^2*s^-2": "Енергия / Работа E/A [J]",
  "kg*m^2*s^-3": "Мощност P [W]",
  "kg*m^-1*s^-2": "Налягане P [Pa]",
  "m^2": "Площ A [m²]",
  "m^3": "Обем V [m³]",

  // Rotational
  "rad*s^-1": "Ъглова скорост ω [rad/s]",
  "rad*s^-2": "Ъглово ускорение α [rad/s²]",

  // Electrical / Magnetic
  "A*s": "Електричен заряд Q [C]",
  "kg*m^2*s^-3*A^-1": "Напрежение U [V]",
  "kg*m^2*s^-3*A^-2": "Съпротивление R [Ω]",
  "A^2*s^3*kg^-1*m^-2": "Проводимост S [S]",
  "V*m^-1": "Електрично поле E [V/m]",
  "N*C^-1": "Електрично поле E [N/C]",
  "kg*m^2*s^-2*A^-1": "Магнитен поток Φ [Wb]",
  "kg*s^-2*A^-1": "Магнитна индукция B [T]",
  "kg*m^2*s^-2*A^-2": "Индуктивност L [H]",
  "C*V^-1": "Капацитет C [F]",

  // Frequency / Time
  "s^-1": "Честота f [Hz]",

  // Radiation / Light
  "lm": "Светлинен поток Φv [lm]",
  "cd": "Светимост I [cd]",
  "lx": "Осветеност E [lx]",
  "Gy": "Доза погл. радиация [Gy]",
  "Sv": "Еквивалентна доза радиация [Sv]",
  "kat": "Активност A [kat]"
};


// ---------------- Derived → base ----------------
const derivedToBase = {
  N:"kg*m*s^-2",
  Pa:"kg*m^-1*s^-2",
  J:"kg*m^2*s^-2",
  W:"kg*m^2*s^-3",
  V:"kg*m^2*s^-3*A^-1",
  Ω:"kg*m^2*s^-3*A^-2",
  C:"A*s",
  Hz:"s^-1",
  Wb:"kg*m^2*s^-2*A^-1",
  T:"kg*s^-2*A^-1",
  H:"kg*m^2*s^-2*A^-2"
};

// ---------------- Canonical ----------------
function canonicalUnit(topArr, bottomArr){
  const counts = {};

  [...topArr, ...bottomArr.map(u => u+"^-1")].forEach(u=>{
    const [k,p]=u.split("^");
    counts[k]=(counts[k]||0)+(p?Number(p):1);
  });

  return Object.keys(counts)
    .filter(k=>counts[k]!==0)
    .sort()
    .map(k=>counts[k]===1?k:k+"^"+counts[k])
    .join("*");
}

// ---------------- Fraction-style Pretty ----------------
function prettyFraction(u){
  const parts = u.split("*");
  const topCounts = {};
  const bottomCounts = {};
  const sup={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻"};

  // count top and bottom units
  parts.forEach(p=>{
    const match = p.match(/([a-zA-ZΩ]+)(\^(-?\d+))?/);
    if(!match) return;
    const unit = match[1];
    const exp = match[3]?Number(match[3]):1;
    if(exp>0){
      topCounts[unit] = (topCounts[unit]||0)+exp;
    } else {
      bottomCounts[unit] = (bottomCounts[unit]||0)+(-exp);
    }
  });

  function formatCounts(counts){
    return Object.keys(counts).map(u=>{
      const e = counts[u];
      return e===1 ? u : u + [...e.toString()].map(x=>sup[x]||x).join("");
    }).join("·");
  }

  const topStr = formatCounts(topCounts) || "1";
  const bottomStr = formatCounts(bottomCounts);

  return bottomStr ? `${topStr}/${bottomStr}` : topStr;
}


// ---------------- UI ----------------
function createDraggableButtons(elements,poolId,prefix){
  const pool=document.getElementById(poolId);
  elements.forEach((e,i)=>{
    const btn=document.createElement("button");
    btn.id=prefix+"_"+i;
    btn.draggable=true;
    btn.ondragstart=ev=>ev.dataTransfer.setData("text/plain",btn.id);
    btn.innerHTML=`<div><b>${e.symbol}</b></div><div style="font-size:12px;color:#444">${e.label}</div>`;
    pool.appendChild(btn);
  });
}

function convertDerived(arr){
  return arr.flatMap(u => (derivedToBase[u]||u).split("*")).filter(u=>u!=="1");
}

// ---------------- Slots ----------------
function initSlots(panel){
  const top=[...document.querySelectorAll(`#${panel}_top_slots .slot`)];
  const bottom=[...document.querySelectorAll(`#${panel}_bottom_slots .slot`)];
  const resEl=document.getElementById(`${panel}_res`);

  [...top,...bottom].forEach(slot=>{
    slot.ondragover=e=>e.preventDefault();
    slot.ondrop=e=>{
      const btn=document.getElementById(e.dataTransfer.getData("text/plain"));
      if(!btn) return;
      slot.textContent=btn.children[0].textContent;
      slot.classList.add("filled");
    };
  });

  return {topSlots:top,bottomSlots:bottom,resEl};
}

// ---------------- Actions ----------------
function evaluateSlots(slotData){
  const top=convertDerived(slotData.topSlots.map(s=>s.textContent).filter(Boolean));
  const bottom=convertDerived(slotData.bottomSlots.map(s=>s.textContent).filter(Boolean));

  if(!top.length && !bottom.length){
    slotData.resEl.textContent="—";
    return;
  }

  const key=canonicalUnit(top,bottom);
  slotData.resEl.textContent =
    merna_combos[key]
      ? prettyFraction(key)+"\n"+merna_combos[key]
      : prettyFraction(key)+"\nНяма комбинация";
}

function clearSlots(slotData){
  [...slotData.topSlots,...slotData.bottomSlots].forEach(s=>{
    s.textContent="";
    s.classList.remove("filled");
  });
  slotData.resEl.textContent="—";
}

// ---------------- Init ----------------
createDraggableButtons(merna_elements,"merna_pool","merna");
const mernaSlotData=initSlots("merna");
document.getElementById("merna_eval").onclick=()=>evaluateSlots(mernaSlotData);
document.getElementById("merna_clear").onclick=()=>clearSlots(mernaSlotData);
</script>

</body>
</html>
